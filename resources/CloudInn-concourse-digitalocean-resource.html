

<!DOCTYPE html>
<html lang="en">
<head>
    
    <title>Duty Free - DigitalOcean Worker Provision Resource</title>

    <link rel="stylesheet" type="text/css" href="/dutyfree/static/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container detail-page">
    <div class="logo-area">
        <div class="title">
            <h1>CONCOURSE DUTY FREE</h1>
        </div>
    </div>


    <div class="search">
         
    </div>

    <nav class="sidebar">
         
    </nav>

    <main class="content">

        <div class="breadcrumb">
        
        
            
                    <span class="breadcrumb-link"><a href="/dutyfree">All Resources</a></span>
                
        
            
                    <span>DigitalOcean Worker Provision Resource</span>
            
        
        </div>

        
    <section class="top-area">
        <a target="_blank" href="https://github.com/CloudInn/concourse-digitalocean-resource" class="github-icon-detail item">
            <img src="/dutyfree/static/GitHub-Mark-120px-plus.png" alt="Resource Source on Github"
                 title="Resource Source on Github">
        </a>
        <h2 class="name item">DigitalOcean Worker Provision Resource</h2>
        <div class="last-version item"></div>
        <a href="https://github.com/CloudInn" target="_blank" class="author item">CloudInn</a>
    </section>
    <section class="middle-area">
        <div class="row">
            <img class="github-last-commit"
                 alt="GitHub last commit"
                 src="https://img.shields.io/github/last-commit/CloudInn/concourse-digitalocean-resource.svg?label=Last%20commit&labelColor=757474&color=C4C4C4&style=flat-square">
            
    <div class="github-stars">
        <img src="https://img.shields.io/github/stars/CloudInn/concourse-digitalocean-resource.svg?logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAADQAAAAxCAYAAACVtYpYAAAETElEQVRoQ%2B2aWUxTQRSGTymJJvCkLxRp1cSlIIooMS7ghkajGBeEUjEuKGqMJsYFRZaC4IJbjMYoirgrhYoEt6BBg4pRY2JYVEAfBKrwyAMkmgDH3Jqrt5fe3pnbO9QQ7wspnPnP%2F82ZHmam1cAAezQDjAf6Dej8hQLkJm%2FLpo1MczIVF1Z%2FyoyZDqC31c%2BZ5mQqzgPduFWEWTkHHS%2BzM9Mh0WxilpeZsLA6s6IX4Lfv3x2%2FGhYYCFWVFczyMhMWAo0KHu9Ybvzz5VMds7zMhHnz8xbG4NfmZqdmOmb0KHhYfpdJbiai7qrDukpMgZatNGH9h48u%2F9WFjguBMptV9fyqC5JUh2WVmAGt27gZX1a%2FcrsRmRUVCZcunFPVg6piNNVhVSUmQNt37MJHFY%2BJtokxixbCqRPHVPOhmpDQ%2FZhxYdjb20sE5OPjA00falTzoZoQ7z413YIld0qJYPggsykOcrIyVfGiioiS946YWK3dgyKgW0VWbG21Q4vdDo6frXbo7OykqopUsL%2B%2FPxj0QaDXB4EhKAgMBj2YTfHEPiUDufNLK2%2FYboe2tnbo6elRxbRSEa1WCzpdgAPUAazXw%2BbkDU4MTi8uFl7GvGMnlebz6ri9e3ZCctJ6jcsKjQ6ZgIhOG2SvmnWXXKPRwOePtX84JJecMXQidnt5icnNoq%2BvLzTUvZdecmKB0PAI%2FPHjp5yuV%2F4%2BePAgqH%2F%2Frk9BZLtHWMRU7Orq8oppqaR%2Bfn5Q8%2B61S%2B%2ByQJxoxLQo7Ojo%2BCeghg4ZAm%2BqqyR9EwFxJFFz5mNbe7tXoXQBAfDi2RO3nomBOJLoBYuxuaXFK1DDDQaorHgg61c2QOx%2B8dIV2Nj0uV%2BhQoKNUF5aQuSVKEjsfkW8GWvr6vsFavKkcLDevEbskzhQ7J7kROopceSM6XClIJ%2FKI1Ww2OCS5XH4qaHBU98uxwcbjXDvLtkyEwp4BOTqzk0tupEjhsOTR%2Fep%2FVEPEBoW34iqBcPrKDkj%2FQfiZ%2B%2Fq9RuYcyhP7aI46WWk7YO1qxOpJp0qWJgtJTUNS8vKmQLFLl8KeYdyqTxSBQvdxyyLxYbGJqZAxrFj4X6ZjcojVbDQPc1VlVJqJVdcioFoOxx3%2BcE9tJcptJ1OEVBRsQ3TLdnEE59oNnEfRTpyWQ7korXYBqSn4dxsCyTEryT2SRwodJ%2BRlYO3rcWyQNFzZ0P%2B2TMuc2zaug2fPquS1ViVYIIDlt%2BTQfIQBwrFYk2rsKa2TlKfZtsit32aGDYBbEU3iX0SBwrdG8eHY3d3dx%2BgQJ0Onj99rEhT6gDp6iLEXaUUJRc3BO4NvyV5g8dfqjiXfxHzCwr7NA6axuARkK9WCwmmOMjKSFOkIzXTmdm5WFzyt3EwBTp45Chevnod5s2dA%2BfPnlYVRAzIN46kdWtg%2F949RLmIgoSJDh89jqkpu6nHkXQoqRhuEtP2pRDlJAryxEx%2Fjx1wQL8AYxVtQRu%2FaUcAAAAASUVORK5CYII%3D&style=social"
             alt="github_stars">
    </div>

        </div>
        <div class="row">
            <div class="description">
                <h3>Description</h3>
                <div class="desc">
                    
                </div>
                <div class="tags">
                    
                    
                </div>
            </div>
            
        </div>
    </section>
    <section id="github-readme">
        <h3>Read Me</h3>
        <div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content p-5" itemprop="text"><h1><a id="user-content-concourse-digitalocean-worker-provision-resource" class="anchor" aria-hidden="true" href="#concourse-digitalocean-worker-provision-resource"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Concourse DigitalOcean Worker Provision Resource</h1>
<p>A <a href="http://concourse.ci/" rel="nofollow">Concourse</a> resource to minimize CI infrastructure cost by dynamically provision droplets on DigitalOcean and configure them as workers to run pipeline job and destroy them after the job is done (DigitalOcean charges you per hour).</p>
<blockquote>
<p><strong>Note:</strong> This resource is tested on Concourse v3.13.0 and will mostly work on any 3.xx version, but it does not support version 4.00 and higher yet (it has not been tested on it).</p>
</blockquote>
<h2><a id="user-content-limitations" class="anchor" aria-hidden="true" href="#limitations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Limitations</h2>
<ul>
<li>
<p>You'll need at least one Linux worker to be used by the resource to provision more workers</p>
</li>
<li>
<p>It's highly recommended to create and destroy the worker inside the same job to always guarantee the destruction of the droplet, to achieve so use <code>get</code> (destroys worker) under <code>ensure</code> step on the job level to make sure the droplet is always destroyed no matter the job passed or failed.</p>
</li>
<li>
<p>Jobs with worker provisioning should limit running multiple builds of the same job in parallel using <code>serial: true</code> otherwise one build finish will destroy all the workers of all build for the same job causing them to hang, example of using serial:</p>
</li>
</ul>
<pre><code>jobs:
  - name: some-job
    serial: true
    plan:
      - ....
</code></pre>
<h2><a id="user-content-preparations" class="anchor" aria-hidden="true" href="#preparations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preparations</h2>
<ul>
<li>Generate API Key from your DigitalOcean account to be passed as <code>api_key</code> in source</li>
<li>Generate an ssh private key to be passed as <code>droplet_key</code> in source (will be used by the resource to configure the created droplets).</li>
<li>Get Concourse TSA public key to be passed as <code>ci_tsa_pub_key</code> in source</li>
<li>Get the worker private key to be passed as <code>ci_worker_key</code> in srouce, this key should already have its public key added to Concourse web under TSA authorized keys.</li>
<li>Optional, you select the region and droplet size to be used as worker, you can obtain a full list using <a href="https://developers.digitalocean.com/documentation/v2/" rel="nofollow">DigitalOcean API</a></li>
</ul>
<h2><a id="user-content-resource-type-configuration" class="anchor" aria-hidden="true" href="#resource-type-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resource Type Configuration</h2>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">resource_types</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">worker-resource</span>
    <span class="pl-ent">type</span>: <span class="pl-s">docker-image</span>
    <span class="pl-ent">source</span>:
      <span class="pl-ent">repository</span>: <span class="pl-s">cloudinn/concourse-digitalocean-resource</span>
      <span class="pl-ent">tag</span>: <span class="pl-s">latest</span></pre></div>
<h2><a id="user-content-source-configuration" class="anchor" aria-hidden="true" href="#source-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Source Configuration</h2>
<ul>
<li><code>api_key</code>: <em>Required - (String)</em>. A DigitalOcean API key, you can get it through your DigitalOcean account setting.</li>
<li><code>region</code>: <em>Optional - (String)</em>. You can get the list of valid regions through <a href="https://developers.digitalocean.com/documentation/v2/" rel="nofollow">DigitalOcean API</a> (default: <code>ams3</code>)</li>
<li><code>droplet_size</code>: <em>Optional - (String)</em>. You can get the list of valid sizes on selected region through <a href="https://developers.digitalocean.com/documentation/v2/" rel="nofollow">DigitalOcean API</a> (default <code>s-2vcpu-2gb</code>)</li>
<li><code>droplet_kay</code>: <em>Required - (String)</em>. A generated ssh private key used to access the newly created droplets, the key will be used to generate public key and add it to DigitalOcean account add it to the created droplets to be able to access and install and configure concourse worker on them.</li>
<li><code>ci_worker_key</code>: <em>Required - (String)</em>. An ssh private key to be used by the worker to access TSA server, its public key should be previously added to CONCOURSE_TSA_AUTHORIZED_KEYS when configuring Concourse Web.</li>
<li><code>ci_tsa_pub_key</code>: <em>Required - (String)</em>. The public key of the key set in CONCOURSE_TSA_HOST_KEY in Concourse Web, to allow TSA to access this worker.</li>
<li><code>ci_tsa_port</code>: <em>Optional - (String)</em>. Set this if you're using custom TSA port change (default: <code>2222</code>)</li>
<li><code>fly_username</code>: <em>Required - (String)</em>. The username of Concourse basic auth, to allow using <code>fly prune-worker</code> command to make sure the worker is removed from TSA workers registry when it's destroyed.</li>
<li><code>fly_password</code>: <em>Required - (String)</em>. Concourse Web basic auth password for the previous username.</li>
</ul>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">resources</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">worker</span>
  <span class="pl-ent">type</span>: <span class="pl-s">worker-resource</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">api_key</span>: <span class="pl-s">((DO_API_KEY))</span>
    <span class="pl-ent">region</span>: <span class="pl-s"><span class="pl-pds">"</span>ams3<span class="pl-pds">"</span></span>
    <span class="pl-ent">droplet_size</span>: <span class="pl-s"><span class="pl-pds">"</span>s-2vcpu-2gb<span class="pl-pds">"</span></span>
    <span class="pl-ent">droplet_kay</span>: <span class="pl-s">((DO_DROPLET_KEY))</span>
    <span class="pl-ent">ci_worker_key</span>: <span class="pl-s">((CONCOURSE_WORKER_KEY))</span>
    <span class="pl-ent">ci_tsa_pub_key</span>: <span class="pl-s">((CONCOURSE_TSA_PUBKEY))</span>
    <span class="pl-ent">ci_tsa_port</span>: <span class="pl-c1">2222</span>
    <span class="pl-ent">fly_username</span>: <span class="pl-s">((CONCOURSE_BASIC_AUTH_USER))</span>
    <span class="pl-ent">fly_password</span>: <span class="pl-s">((CONCOURSE_BASIC_AUTH_PASS))</span></pre></div>
<h2><a id="user-content-behaviour" class="anchor" aria-hidden="true" href="#behaviour"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Behaviour</h2>
<h3><a id="user-content-check-non-functional" class="anchor" aria-hidden="true" href="#check-non-functional"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>check</code>: Non-functional</h3>
<h3><a id="user-content-out-put-provision-droplet-and-register-as-worker" class="anchor" aria-hidden="true" href="#out-put-provision-droplet-and-register-as-worker"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>out</code> (put): Provision droplet and register as worker</h3>
<p>Provision worker with the given name (tag) that can be used to tag later steps to run on the created worker.</p>
<blockquote>
<p>You might want to use <code>timeout</code> step modifier with <code>3.5m</code> in this resource put step to avoid the rare case when DigitalOcean API fails creating the worker or taking so long (Usually if it takes more then 3.5 minutes then it's bugged)</p>
</blockquote>
<h5><a id="user-content-params" class="anchor" aria-hidden="true" href="#params"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>params</h5>
<ul>
<li><code>worker_name</code>: <em>Required - (String)</em>. A unique name across all pipelines for digitalocean account, must be valid hostname (contains alphanumerics and hyphens), this name should be used in tags on later job steps to make them run on the provisioned worker (using the same name for workers in multiple jobs running in parallel will cause one finished job to destroy all workers with the same name that are running other jobs, leads to other jobs running on the worker with the same name to hang).</li>
</ul>
<h5><a id="user-content-get_params" class="anchor" aria-hidden="true" href="#get_params"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>get_params</h5>
<ul>
<li><code>dont_destroy</code>:  <em>Required - (Boolean)</em>. You must always set to <code>true</code>. Concourse by default does implicit get after put to any resource, this behavior will lead to destroy the worker we just created, this parameter is used by the resource to prevent this behavior. If you don't pass it the put step won't fail but the worker will get instantly destroyed after it's created what makes the resource useless.</li>
</ul>
<h3><a id="user-content-in-get-destroy-the-droplet-and-prune-the-worker" class="anchor" aria-hidden="true" href="#in-get-destroy-the-droplet-and-prune-the-worker"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>in</code> (get): Destroy the droplet and prune the worker</h3>
<p>Destroy the created droplet and prune the worker from Concourse registry, this step shouldn't be executed on the same worker being destroyed.</p>
<h5><a id="user-content-params-1" class="anchor" aria-hidden="true" href="#params-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>params</h5>
<ul>
<li><code>worker_name</code>: <em>Required - (String)</em>. A unique name across all pipelines for digitalocean account, must be valid hostname (contains alphanumerics and hyphens), this name should be used in tags on later job steps to make them run on the provisioned worker (using the same name for workers in multiple jobs running in parallel will cause one finished job to destroy all workers with the same name that are running other jobs, leads to other jobs running on the worker with the same name to hang).</li>
</ul>
<h2><a id="user-content-example" class="anchor" aria-hidden="true" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h2>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">resource_types</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">worker-resource</span>
  <span class="pl-ent">type</span>: <span class="pl-s">docker-image</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">repository</span>: <span class="pl-s">cloudinn/concourse-digitalocean-resource</span>
    <span class="pl-ent">tag</span>: <span class="pl-s">latest</span>

<span class="pl-ent">resources</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">worker</span>
  <span class="pl-ent">type</span>: <span class="pl-s">worker-resource</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">api_key</span>: <span class="pl-s">((DO_API_KEY))</span>
    <span class="pl-ent">region</span>: <span class="pl-s"><span class="pl-pds">"</span>ams3<span class="pl-pds">"</span></span>
    <span class="pl-ent">droplet_size</span>: <span class="pl-s"><span class="pl-pds">"</span>s-2vcpu-2gb<span class="pl-pds">"</span></span>
    <span class="pl-ent">ci_worker_key</span>: <span class="pl-s">((CONCOURSE_WORKER_KEY))</span>
    <span class="pl-ent">ci_tsa_pub_key</span>: <span class="pl-s">((CONCOURSE_TSA_PUB_KEY))</span>
    <span class="pl-ent">fly_username</span>: <span class="pl-s">((FLY_USERNAME))</span>
    <span class="pl-ent">fly_password</span>: <span class="pl-s">((FLY_PASSWORD))</span>
    <span class="pl-ent">droplet_key</span>: <span class="pl-s">((DO_VM_KEY))</span>

<span class="pl-ent">jobs</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">build</span>
    <span class="pl-ent">serial</span>: <span class="pl-c1">true</span>
    <span class="pl-ent">plan</span>:
      - <span class="pl-ent">put</span>: <span class="pl-s">worker</span>
        <span class="pl-ent">timeout</span>: <span class="pl-s">3.5m</span>
        <span class="pl-ent">params</span>:
          <span class="pl-ent">worker_name</span>: <span class="pl-s">job-x-build-worker</span>
        <span class="pl-ent">get_params</span>:
          <span class="pl-ent">dont_destroy</span>: <span class="pl-c1">true</span>

      - <span class="pl-ent">task</span>: <span class="pl-s">some-task</span>
        <span class="pl-ent">tags</span>: <span class="pl-s">[job-x-build-worker]</span>
        <span class="pl-ent">config</span>:
          <span class="pl-ent">platform</span>: <span class="pl-s">linux</span>
          <span class="pl-ent">image_resource</span>:
            <span class="pl-ent">type</span>: <span class="pl-s">docker-image</span>
            <span class="pl-ent">source</span>:
              <span class="pl-ent">repository</span>: <span class="pl-s">alpine</span>
          <span class="pl-ent">run</span>:
            <span class="pl-ent">path</span>: <span class="pl-s">sh</span>
            <span class="pl-ent">args</span>:
              - <span class="pl-s">-exc</span>
              - <span class="pl-s">|</span>
<span class="pl-s">                echo "A task/step running on: job-x-build-worker"</span>
<span class="pl-s"></span>
<span class="pl-s"></span>    <span class="pl-ent">ensure</span>:
      <span class="pl-ent">get</span>: <span class="pl-s">worker</span>
      <span class="pl-ent">params</span>:
        <span class="pl-ent">worker_name</span>: <span class="pl-s">job-x-build-worker</span></pre></div>
<h2><a id="user-content-license" class="anchor" aria-hidden="true" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h2>
<p>Apache License 2.0</p>
</article></div>
    </section>


    </main>
</div>
    
</body>
</html>







