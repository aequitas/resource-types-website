

<!DOCTYPE html>
<html lang="en">
<head>
    
    <title>Duty Free - Github Pull Requests</title>

    <link rel="stylesheet" type="text/css" href="/dutyfree/static/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container detail-page">
    <div class="logo-area">
        <div class="title">
            <h1>CONCOURSE DUTY FREE</h1>
        </div>
    </div>


    <div class="search">
         
    </div>

    <nav class="sidebar">
         
    </nav>

    <main class="content">

        <div class="breadcrumb">
        
        
            
                    <span class="breadcrumb-link"><a href="/dutyfree">All Resources</a></span>
                
        
            
                    <span>Github Pull Requests</span>
            
        
        </div>

        
    <section class="top-area">
        <a target="_blank" href="https://github.com/telia-oss/github-pr-resource" class="github-icon-detail item">
            <img src="/dutyfree/static/GitHub-Mark-120px-plus.png" alt="Resource Source on Github"
                 title="Resource Source on Github">
        </a>
        <h2 class="name item">Github Pull Requests</h2>
        <div class="last-version item"></div>
        <a href="https://github.com/telia-oss" target="_blank" class="author item">telia-oss</a>
    </section>
    <section class="middle-area">
        <div class="row">
            <img class="github-last-commit"
                 alt="GitHub last commit"
                 src="https://img.shields.io/github/last-commit/telia-oss/github-pr-resource.svg?label=Last%20commit&labelColor=757474&color=C4C4C4&style=flat-square">
            
    <div class="github-stars">
        <img src="https://img.shields.io/github/stars/telia-oss/github-pr-resource.svg?logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAADQAAAAxCAYAAACVtYpYAAAETElEQVRoQ%2B2aWUxTQRSGTymJJvCkLxRp1cSlIIooMS7ghkajGBeEUjEuKGqMJsYFRZaC4IJbjMYoirgrhYoEt6BBg4pRY2JYVEAfBKrwyAMkmgDH3Jqrt5fe3pnbO9QQ7wspnPnP%2F82ZHmam1cAAezQDjAf6Dej8hQLkJm%2FLpo1MczIVF1Z%2FyoyZDqC31c%2BZ5mQqzgPduFWEWTkHHS%2BzM9Mh0WxilpeZsLA6s6IX4Lfv3x2%2FGhYYCFWVFczyMhMWAo0KHu9Ybvzz5VMds7zMhHnz8xbG4NfmZqdmOmb0KHhYfpdJbiai7qrDukpMgZatNGH9h48u%2F9WFjguBMptV9fyqC5JUh2WVmAGt27gZX1a%2FcrsRmRUVCZcunFPVg6piNNVhVSUmQNt37MJHFY%2BJtokxixbCqRPHVPOhmpDQ%2FZhxYdjb20sE5OPjA00falTzoZoQ7z413YIld0qJYPggsykOcrIyVfGiioiS946YWK3dgyKgW0VWbG21Q4vdDo6frXbo7OykqopUsL%2B%2FPxj0QaDXB4EhKAgMBj2YTfHEPiUDufNLK2%2FYboe2tnbo6elRxbRSEa1WCzpdgAPUAazXw%2BbkDU4MTi8uFl7GvGMnlebz6ri9e3ZCctJ6jcsKjQ6ZgIhOG2SvmnWXXKPRwOePtX84JJecMXQidnt5icnNoq%2BvLzTUvZdecmKB0PAI%2FPHjp5yuV%2F4%2BePAgqH%2F%2Frk9BZLtHWMRU7Orq8oppqaR%2Bfn5Q8%2B61S%2B%2ByQJxoxLQo7Ojo%2BCeghg4ZAm%2BqqyR9EwFxJFFz5mNbe7tXoXQBAfDi2RO3nomBOJLoBYuxuaXFK1DDDQaorHgg61c2QOx%2B8dIV2Nj0uV%2BhQoKNUF5aQuSVKEjsfkW8GWvr6vsFavKkcLDevEbskzhQ7J7kROopceSM6XClIJ%2FKI1Ww2OCS5XH4qaHBU98uxwcbjXDvLtkyEwp4BOTqzk0tupEjhsOTR%2Fep%2FVEPEBoW34iqBcPrKDkj%2FQfiZ%2B%2Fq9RuYcyhP7aI46WWk7YO1qxOpJp0qWJgtJTUNS8vKmQLFLl8KeYdyqTxSBQvdxyyLxYbGJqZAxrFj4X6ZjcojVbDQPc1VlVJqJVdcioFoOxx3%2BcE9tJcptJ1OEVBRsQ3TLdnEE59oNnEfRTpyWQ7korXYBqSn4dxsCyTEryT2SRwodJ%2BRlYO3rcWyQNFzZ0P%2B2TMuc2zaug2fPquS1ViVYIIDlt%2BTQfIQBwrFYk2rsKa2TlKfZtsit32aGDYBbEU3iX0SBwrdG8eHY3d3dx%2BgQJ0Onj99rEhT6gDp6iLEXaUUJRc3BO4NvyV5g8dfqjiXfxHzCwr7NA6axuARkK9WCwmmOMjKSFOkIzXTmdm5WFzyt3EwBTp45Chevnod5s2dA%2BfPnlYVRAzIN46kdWtg%2F949RLmIgoSJDh89jqkpu6nHkXQoqRhuEtP2pRDlJAryxEx%2Fjx1wQL8AYxVtQRu%2FaUcAAAAASUVORK5CYII%3D&style=social"
             alt="github_stars">
    </div>

        </div>
        <div class="row">
            <div class="description">
                <h3>Description</h3>
                <div class="desc">
                    A Concourse resource for pull requests on Github. Written in Go and based on the Github V4 (GraphQL) API.
                </div>
                <div class="tags">
                    
                        <span class="get">GET</span>
                    
                    
                        <span class="put">PUT</span>
                    
                </div>
            </div>
            
        </div>
    </section>
    <section id="github-readme">
        <h3>Read Me</h3>
        <div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content p-5" itemprop="text"><h2><a id="user-content-github-pr-resource" class="anchor" aria-hidden="true" href="#github-pr-resource"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Github PR resource</h2>
<p><a href="https://travis-ci.org/telia-oss/github-pr-resource" rel="nofollow"><img src="https://camo.githubusercontent.com/84d5ca09d75267bcb990e569b01b19e0daa591b1/68747470733a2f2f7472617669732d63692e6f72672f74656c69612d6f73732f6769746875622d70722d7265736f757263652e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/telia-oss/github-pr-resource.svg?branch=master" style="max-width:100%;"></a>
<a href="https://goreportcard.com/report/github.com/telia-oss/github-pr-resource" rel="nofollow"><img src="https://camo.githubusercontent.com/697bd3039e12b635e08b8999179e1ca7b98b40da/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f74656c69612d6f73732f6769746875622d70722d7265736f75726365" alt="Go Report Card" data-canonical-src="https://goreportcard.com/badge/github.com/telia-oss/github-pr-resource" style="max-width:100%;"></a>
<a href="https://hub.docker.com/r/teliaoss/github-pr-resource/" rel="nofollow"><img src="https://camo.githubusercontent.com/a916b749bbe7baec53a6f0533651c9499e502b21/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f6175746f6d617465642f74656c69616f73732f6769746875622d70722d7265736f757263652e737667" alt="Docker Automated build" data-canonical-src="https://img.shields.io/docker/automated/teliaoss/github-pr-resource.svg" style="max-width:100%;"></a></p>
<p>A Concourse resource for pull requests on Github. Written in Go and based on the <a href="https://developer.github.com/v4">Github V4 (GraphQL) API</a>.
Inspired by <a href="https://github.com/jtarchie/github-pullrequest-resource">the original</a>, with some important differences:</p>
<ul>
<li>Github V4: <code>check</code> only requires 1 API call per 100th <em>open</em> pull request. (See <a href="#costs">#costs</a> for more information).</li>
<li>Fetch/merge: <code>get</code> will always merge a specific commit from the Pull request into the latest base.</li>
<li>Metadata: <code>get</code> and <code>put</code> provides information about which commit (SHA) was used from both the PR and base.</li>
<li>Webhooks: Does not implement any caching thanks to GraphQL, which means it works well with webhooks.</li>
</ul>
<p>Make sure to check out <a href="#migrating">#migrating</a> to learn more.</p>
<h2><a id="user-content-source-configuration" class="anchor" aria-hidden="true" href="#source-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Source Configuration</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>repository</code></td>
<td>Yes</td>
<td><code>itsdalmo/test-repository</code></td>
<td>The repository to target.</td>
</tr>
<tr>
<td><code>access_token</code></td>
<td>Yes</td>
<td></td>
<td>A Github Access Token with repository access (required for setting status on commits). N.B. If you want github-pr-resource to work with a private repository. Set <code>repo:full</code> permissions on the access token you create on GitHub. If it is a public repository, <code>repo:status</code> is enough.</td>
</tr>
<tr>
<td><code>v3_endpoint</code></td>
<td>No</td>
<td><code>https://api.github.com</code></td>
<td>Endpoint to use for the V3 Github API (Restful).</td>
</tr>
<tr>
<td><code>v4_endpoint</code></td>
<td>No</td>
<td><code>https://api.github.com/graphql</code></td>
<td>Endpoint to use for the V4 Github API (Graphql).</td>
</tr>
<tr>
<td><code>paths</code></td>
<td>No</td>
<td><code>terraform/*/*.tf</code></td>
<td>Only produce new versions if the PR includes changes to files that match one or more glob patterns or prefixes.</td>
</tr>
<tr>
<td><code>ignore_paths</code></td>
<td>No</td>
<td><code>.ci/</code></td>
<td>Inverse of the above. Pattern syntax is documented in <a href="https://golang.org/pkg/path/filepath/#Match" rel="nofollow">filepath.Match</a>, or a path prefix can be specified (e.g. <code>.ci/</code> will match everything in the <code>.ci</code> directory).</td>
</tr>
<tr>
<td><code>disable_ci_skip</code></td>
<td>No</td>
<td><code>true</code></td>
<td>Disable ability to skip builds with <code>[ci skip]</code> and <code>[skip ci]</code> in commit message or pull request title.</td>
</tr>
<tr>
<td><code>skip_ssl_verification</code></td>
<td>No</td>
<td><code>true</code></td>
<td>Disable SSL/TLS certificate validation on git and API clients. Use with care!</td>
</tr>
<tr>
<td><code>disable_forks</code></td>
<td>No</td>
<td><code>true</code></td>
<td>Disable triggering of the resource if the pull request's fork repository is different to the configured repository.</td>
</tr>
<tr>
<td><code>required_review_approvals</code></td>
<td>No</td>
<td><code>2</code></td>
<td>Disable triggering of the resource if the pull request does not have at least <code>X</code> approved review(s).</td>
</tr>
<tr>
<td><code>git_crypt_key</code></td>
<td>No</td>
<td><code>AEdJVENSWVBUS0VZAAAAA...</code></td>
<td>Base64 encoded git-crypt key. Setting this will unlock / decrypt the repository with git-crypt. To get the key simply execute `git-crypt export-key -- -</td>
</tr>
<tr>
<td><code>base_branch</code></td>
<td>No</td>
<td><code>master</code></td>
<td>Name of a branch. The pipeline will only trigger on pull requests against the specified branch.</td>
</tr>
<tr>
<td><code>labels</code></td>
<td>No</td>
<td><code>["bug", "enhancement"]</code></td>
<td>The labels on the PR. The pipeline will only trigger on pull requests having at least one of the specified labels.</td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul>
<li>If <code>v3_endpoint</code> is set, <code>v4_endpoint</code> must also be set (and the other way around).</li>
<li>Look at the <a href="https://concourse-ci.org/resources.html#resource-webhook-token" rel="nofollow">Concourse Resources documentation</a>
for webhook token configuration.</li>
<li>When using <code>required_review_approvals</code>, you may also want to enable GitHub's branch protection rules to <a href="https://help.github.com/en/articles/enabling-required-reviews-for-pull-requests">dismiss stale pull request approvals when new commits are pushed</a>.</li>
</ul>
<h2><a id="user-content-behaviour" class="anchor" aria-hidden="true" href="#behaviour"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Behaviour</h2>
<h4><a id="user-content-check" class="anchor" aria-hidden="true" href="#check"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>check</code></h4>
<p>Produces new versions for all commits (after the last version) ordered by the committed date.
A version is represented as follows:</p>
<ul>
<li><code>pr</code>: The pull request number.</li>
<li><code>commit</code>: The commit SHA.</li>
<li><code>committed</code>: Timestamp of when the commit was committed. Used to filter subsequent checks.</li>
</ul>
<p>If several commits are pushed to a given PR at the same time, the last commit will be the new version.</p>
<p><strong>Note on webhooks:</strong>
This resource does not implement any caching, so it should work well with webhooks (should be subscribed to <code>push</code> and <code>pull_request</code> events).
One thing to keep in mind however, is that pull requests that are opened from a fork and commits to said fork will not
generate notifications over the webhook. So if you have a repository with little traffic and expect pull requests from forks,
you'll need to discover those versions with <code>check_every: 1m</code> for instance. <code>check</code> in this resource is not a costly operation,
so normally you should not have to worry about the rate limit.</p>
<h4><a id="user-content-get" class="anchor" aria-hidden="true" href="#get"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>get</code></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>skip_download</code></td>
<td>No</td>
<td><code>true</code></td>
<td>Use with <code>get_params</code> in a <code>put</code> step to do nothing on the implicit get.</td>
</tr>
<tr>
<td><code>integration_tool</code></td>
<td>No</td>
<td><code>rebase</code></td>
<td>The integration tool to use, <code>merge</code>, <code>rebase</code> or <code>checkout</code>. Defaults to <code>merge</code>.</td>
</tr>
<tr>
<td><code>git_depth</code></td>
<td>No</td>
<td><code>1</code></td>
<td>Shallow clone the repository using the <code>--depth</code> Git option</td>
</tr>
<tr>
<td><code>list_changed_files</code></td>
<td>No</td>
<td><code>true</code></td>
<td>Generate a list of changed files and save alongside metadata</td>
</tr>
</tbody>
</table>
<p>Clones the base (e.g. <code>master</code> branch) at the latest commit, and merges the pull request at the specified commit
into master. This ensures that we are both testing and setting status on the exact commit that was requested in
input. Because the base of the PR is not locked to a specific commit in versions emitted from <code>check</code>, a fresh
<code>get</code> will always use the latest commit in master and <em>report the SHA of said commit in the metadata</em>. Both the
requested version and the metadata emitted by <code>get</code> are available to your tasks as JSON:</p>
<ul>
<li><code>.git/resource/version.json</code></li>
<li><code>.git/resource/metadata.json</code></li>
<li><code>.git/resource/changed_files</code> (if enabled by <code>list_changed_files</code>)</li>
</ul>
<p>The information in <code>metadata.json</code> is also available as individual files in the <code>.git/resource</code> directory, e.g. the <code>base_sha</code>
is available as <code>.git/resource/base_sha</code>. For a complete list of available (individual) metadata files, please check the code
<a href="https://github.com/telia-oss/github-pr-resource/blob/master/in.go#L66">here</a>.</p>
<p>When specifying <code>skip_download</code> the pull request volume mounted to subsequent tasks will be empty, which is a problem
when you set e.g. the pending status before running the actual tests. The workaround for this is to use an alias for
the <code>put</code> (see <a href="https://github.com/telia-oss/github-pr-resource/issues/32">https://github.com/telia-oss/github-pr-resource/issues/32</a> for more details).</p>
<p>git-crypt encrypted repositories will automatically be decrypted when the <code>git_crypt_key</code> is set in the source configuration.</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">put</span>: <span class="pl-s">update-status &lt;-- Use an alias for the pull-request resource</span>
<span class="pl-ent">resource</span>: <span class="pl-s">pull-request</span>
<span class="pl-ent">params</span>:
    <span class="pl-ent">path</span>: <span class="pl-s">pull-request</span>
    <span class="pl-ent">status</span>: <span class="pl-s">pending</span>
<span class="pl-ent">get_params</span>: <span class="pl-s">{skip_download: true}</span></pre></div>
<p>Note that, should you retrigger a build in the hopes of testing the last commit to a PR against a newer version of
the base, Concourse will reuse the volume (i.e. not trigger a new <code>get</code>) if it still exists, which can produce
unexpected results (#5). As such, re-testing a PR against a newer version of the base is best done by <em>pushing an
empty commit to the PR</em>.</p>
<h4><a id="user-content-put" class="anchor" aria-hidden="true" href="#put"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>put</code></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td>Yes</td>
<td><code>pull-request</code></td>
<td>The name given to the resource in a GET step.</td>
</tr>
<tr>
<td><code>status</code></td>
<td>No</td>
<td><code>SUCCESS</code></td>
<td>Set a status on a commit. One of <code>SUCCESS</code>, <code>PENDING</code>, <code>FAILURE</code> and <code>ERROR</code>.</td>
</tr>
<tr>
<td><code>base_context</code></td>
<td>No</td>
<td><code>concourse-ci</code></td>
<td>Base context (prefix) used for the status context. Defaults to <code>concourse-ci</code>.</td>
</tr>
<tr>
<td><code>context</code></td>
<td>No</td>
<td><code>unit-test</code></td>
<td>A context to use for the status, which is prefixed by <code>base_context</code>. Defaults to <code>status</code>.</td>
</tr>
<tr>
<td><code>comment</code></td>
<td>No</td>
<td><code>hello world!</code></td>
<td>A comment to add to the pull request.</td>
</tr>
<tr>
<td><code>comment_file</code></td>
<td>No</td>
<td><code>my-output/comment.txt</code></td>
<td>Path to file containing a comment to add to the pull request (e.g. output of <code>terraform plan</code>).</td>
</tr>
<tr>
<td><code>target_url</code></td>
<td>No</td>
<td><code>$ATC_EXTERNAL_URL/builds/$BUILD_ID</code></td>
<td>The target URL for the status, where users are sent when clicking details (defaults to the Concourse build page).</td>
</tr>
<tr>
<td><code>description</code></td>
<td>No</td>
<td><code>Concourse CI build failed</code></td>
<td>The description status on the specified pull request.</td>
</tr>
<tr>
<td><code>description_file</code></td>
<td>No</td>
<td><code>my-output/description.txt</code></td>
<td>Path to file containing the description status to add to the pull request</td>
</tr>
<tr>
<td><code>delete_previous_comments</code></td>
<td>No</td>
<td><code>true</code></td>
<td>Boolean. Previous comments made on the pull request by this resource will be deleted before making the new comment. Useful for removing outdated information.</td>
</tr>
</tbody>
</table>
<p>Note that <code>comment</code>, <code>comment_file</code> and <code>target_url</code> will all expand environment variables, so in the examples above <code>$ATC_EXTERNAL_URL</code> will be replaced by the public URL of the Concourse ATCs.
See <a href="https://concourse-ci.org/implementing-resource-types.html#resource-metadata" rel="nofollow">https://concourse-ci.org/implementing-resource-types.html#resource-metadata</a> for more details about metadata that is available via environment variables.</p>
<h2><a id="user-content-example" class="anchor" aria-hidden="true" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h2>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">resource_types</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">pull-request</span>
  <span class="pl-ent">type</span>: <span class="pl-s">docker-image</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">repository</span>: <span class="pl-s">teliaoss/github-pr-resource</span>

<span class="pl-ent">resources</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">pull-request</span>
  <span class="pl-ent">type</span>: <span class="pl-s">pull-request</span>
  <span class="pl-ent">check_every</span>: <span class="pl-c1">24h</span>
  <span class="pl-ent">webhook_token</span>: <span class="pl-s">((webhook-token))</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">repository</span>: <span class="pl-s">itsdalmo/test-repository</span>
    <span class="pl-ent">access_token</span>: <span class="pl-s">((github-access-token))</span>

<span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">test</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">pull-request</span>
    <span class="pl-ent">trigger</span>: <span class="pl-c1">true</span>
    <span class="pl-ent">version</span>: <span class="pl-s">every</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">pull-request</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">path</span>: <span class="pl-s">pull-request</span>
      <span class="pl-ent">status</span>: <span class="pl-s">pending</span>
  - <span class="pl-ent">task</span>: <span class="pl-s">unit-test</span>
    <span class="pl-ent">config</span>:
      <span class="pl-ent">platform</span>: <span class="pl-s">linux</span>
      <span class="pl-ent">image_resource</span>:
        <span class="pl-ent">type</span>: <span class="pl-s">docker-image</span>
        <span class="pl-ent">source</span>: <span class="pl-s">{repository: alpine/git, tag: "latest"}</span>
      <span class="pl-ent">inputs</span>:
        - <span class="pl-ent">name</span>: <span class="pl-s">pull-request</span>
      <span class="pl-ent">run</span>:
        <span class="pl-ent">path</span>: <span class="pl-s">/bin/sh</span>
        <span class="pl-ent">args</span>:
          - <span class="pl-s">-xce</span>
          - <span class="pl-s">|</span>
<span class="pl-s">            cd pull-request</span>
<span class="pl-s">            git log --graph --all --color --pretty=format:"%x1b[31m%h%x09%x1b[32m%d%x1b[0m%x20%s" &gt; log.txt</span>
<span class="pl-s">            cat log.txt</span>
<span class="pl-s"></span>    <span class="pl-ent">on_failure</span>:
      <span class="pl-ent">put</span>: <span class="pl-s">pull-request</span>
      <span class="pl-ent">params</span>:
        <span class="pl-ent">path</span>: <span class="pl-s">pull-request</span>
        <span class="pl-ent">status</span>: <span class="pl-s">failure</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">pull-request</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">path</span>: <span class="pl-s">pull-request</span>
      <span class="pl-ent">status</span>: <span class="pl-s">success</span></pre></div>
<h2><a id="user-content-costs" class="anchor" aria-hidden="true" href="#costs"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Costs</h2>
<p>The Github API(s) have a rate limit of 5000 requests per hour (per user). For the V3 API this essentially
translates to 5000 requests, whereas for the V4 API (GraphQL)  the calculation is more involved:
<a href="https://developer.github.com/v4/guides/resource-limitations/#calculating-a-rate-limit-score-before-running-the-call">https://developer.github.com/v4/guides/resource-limitations/#calculating-a-rate-limit-score-before-running-the-call</a></p>
<p>Ref the above, here are some examples of running <code>check</code> against large repositories and the cost of doing so:</p>
<ul>
<li><a href="https://github.com/concourse/concourse">concourse/concourse</a>: 51 open pull requests at the time of testing. Cost 2.</li>
<li><a href="https://github.com/torvalds/linux">torvalds/linux</a>: 305 open pull requests. Cost 8.</li>
<li><a href="https://github.com/kubernetes/kubernetes">kubernetes/kubernetes</a>: 1072 open pull requests. Cost: 22.</li>
</ul>
<p>For the other two operations the costing is a bit easier:</p>
<ul>
<li><code>get</code>: Fixed cost of 1. Fetches the pull request at the given commit.</li>
<li><code>put</code>: Uses the V3 API and has a min cost of 1, +1 for each of <code>status</code>, <code>comment</code> and <code>comment_file</code> etc.</li>
</ul>
<h2><a id="user-content-migrating" class="anchor" aria-hidden="true" href="#migrating"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Migrating</h2>
<p>If you are coming from <a href="https://github.com/jtarchie/github-pullrequest-resource">jtarchie/github-pullrequest-resource</a>, its important to know that this resource is inspired by <em>but not a drop-in replacement for</em> the original. Here are some important differences:</p>
<h4><a id="user-content-new-parameters" class="anchor" aria-hidden="true" href="#new-parameters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New parameters:</h4>
<ul>
<li><code>source</code>:
<ul>
<li><code>v4_endpoint</code> (see description above)</li>
</ul>
</li>
<li><code>put</code>:
<ul>
<li><code>comment</code> (see description above)</li>
</ul>
</li>
</ul>
<h4><a id="user-content-parameters-that-have-been-renamed" class="anchor" aria-hidden="true" href="#parameters-that-have-been-renamed"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parameters that have been renamed:</h4>
<ul>
<li><code>source</code>:
<ul>
<li><code>repo</code> -&gt; <code>repository</code></li>
<li><code>ci_skip</code> -&gt; <code>disable_ci_skip</code> (the logic has been inverted and its <code>true</code> by default)</li>
<li><code>api_endpoint</code> -&gt; <code>v3_endpoint</code></li>
<li><code>base</code> -&gt; <code>base_branch</code></li>
<li><code>base_url</code> -&gt; <code>target_url</code></li>
<li><code>require_review_approval</code> -&gt; <code>required_review_approvals</code> (<code>bool</code> to <code>int</code>)</li>
</ul>
</li>
<li><code>get</code>:
<ul>
<li><code>git.depth</code> -&gt; <code>git_depth</code></li>
</ul>
</li>
<li><code>put</code>:
<ul>
<li><code>comment</code> -&gt; <code>comment_file</code> (because we added <code>comment</code>)</li>
</ul>
</li>
</ul>
<h4><a id="user-content-parameters-that-are-no-longer-needed" class="anchor" aria-hidden="true" href="#parameters-that-are-no-longer-needed"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parameters that are no longer needed:</h4>
<ul>
<li><code>src</code>:
<ul>
<li><code>uri</code>: We fetch the URI directly from the Github API instead.</li>
<li><code>private_key</code>: We clone over HTTPS using the access token for authentication.</li>
<li><code>username</code>: Same as above</li>
<li><code>password</code>: Same as above</li>
<li><code>only_mergeable</code>: We are opinionated and simply fail to <code>get</code> if it does not merge.</li>
</ul>
</li>
<li><code>get</code>:
<ul>
<li><code>fetch_merge</code>: We are opinionated and always do a fetch_merge.</li>
</ul>
</li>
</ul>
<h4><a id="user-content-parameters-that-did-not-make-it" class="anchor" aria-hidden="true" href="#parameters-that-did-not-make-it"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parameters that did not make it:</h4>
<ul>
<li><code>src</code>:
<ul>
<li><code>authorship_restriction</code></li>
<li><code>label</code></li>
<li><code>git_config</code>: You can now get the pr/author info from .git/resource/metadata.json instead</li>
</ul>
</li>
<li><code>get</code>:
<ul>
<li><code>git.*</code> (with the exception of <code>git_depth</code>, see above)</li>
</ul>
</li>
<li><code>put</code>:
<ul>
<li><code>merge.*</code></li>
<li><code>label</code></li>
</ul>
</li>
</ul>
<p>Note that if you are migrating from the original resource on a Concourse version prior to <code>v5.0.0</code>, you might
see an error <code>failed to unmarshal request: json: unknown field "ref"</code>. The solution is to rename the resource
so that the history is wiped. See <a href="https://github.com/telia-oss/github-pr-resource/issues/64">#64</a> for details.</p>
</article></div>
    </section>


    </main>
</div>
    
</body>
</html>







